<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<title>Lane change tool</title>
<meta property="og:image" content="../favico.png" />
<link rel="icon" href="../favico.png" type="image/x-icon"/>
<link rel="shortcut icon" href="../favico.png" type="image/x-icon"/>
</head>
<body lang=EN onload="toggle_warning()">
<h2>OSM Lane Tool</h2>
Warning this website <s>may contain</s> definitely contains bugs.<br>
Destination fields and lanes are now draggable. Best used with mouse.<br>
Click and hold ‚ñë‚ñë to drag fields. For lanes, click and drag anywhere in arrows section.<br>
<div class=hide id=warning>
<!-- special warning for old website-->
<h3>Tool on this website isn't maintained.</h3>
(As of 6th Jan 2021)<br>
Please visit <b><a href="https://kallejre.github.io/geo/osm%20lane%20tool/">https://kallejre.github.io/geo/osm lane tool/</a></b> instead.<br> 
This site will be taken down by July 2021.
</div>
<style>
body {
    font-family: sans-serif;}
table {
    border-collapse: collapse;
}
table, td {
    border:1px solid ;
    padding:0px;
}
td > button {
    display: inline-block;
    width: 100%;
    height: 100%;
}
td > div > img {
    position:absolute;
    vertical-align:middle;
    top: 0px;
}
li {
    font-family: monospace;
    /*
    border-color: #a94442;
    -webkit-box-shadow: inset 0 1px 2px rgba(0,0,0,.075);
    box-shadow: inset 0 2px 2px rgba(0,0,0,.075);
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    */
}
#main-lanes-row > td {
    vertical-align: bottom;
    display: table-cell;
    min-width:300px;
}
td {
    display: table-cell;}
.destiation_input {
    width: 83%;
}
.destiation_select {
    width: 100%;
}
td > div {
    height:69px;
    position:relative;
}
#warning {color:red;}
.hide {
    display:none;
}

.speed_limit {
  border-radius: 100px;
  border: 10px solid #ff0000;
  padding: 10px; 
  width: 80px;
  height: 80px;  
  font-size: 60px; font: agency fb;
  text-align: center;}
#out-pre {
  width: 60em;
  height: 10em;
  font-family: monospace;
}
</style>
<button type="button" onclick="addColumn()">Add lane</button>
<button type="button" title="Outputs tags for OSM" onclick="exportOSM()">Export</button>
<button type="button" title="Imports lane data" onclick="importOSM(false)">Import (overwrite)</button>
<button type="button" title="Adds lane data to existing" onclick="importOSM(true)">Import (extend)</button>
<button type="button" title="Very broken" disabled=true onclick="broken()">Switch forward/backward</button>
<button type="button" id="lhdrhd_button" title="This button has only cosmetic effect" onclick="lhdrhd()">Switch to LHT</button>
<input type="checkbox" checked=true id="refSum"/><label for="refSum">Consolidate imported ref-tags</label>
<!-- Switching function needs at least 3 new classes and custom variables for image URL. -->
    <script type="text/javascript" src="script.js"></script>
    <link href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" rel="stylesheet">
      <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqgrid/4.6.0/plugins/jquery.tablednd.js"></script>

  <!--script type="text/javascript">
  $(function() {
    $( ".dest_table_body").sortable({
      //connectWith: ".dest_table_body"
    });
  });
  </script-->
<table id=main-lanes  border=1 >
  <tr id="main-lanes-row" >
    <!-- This is here where all the lanes will be shown. -->
  </tr>
</table>

<div id=out-div><br><br>
<textarea id=out-pre onclick="clearText()">You can paste tags to be imported here.
Export will later overwrite this text.

Remember, unsupported tags will be lost between import-export, 
so make sure to keep separate copy of original tags.
Later in your main editor, just paste output from this textbox 
after last of existing tags to update existing ones.</textarea>
</div>
<button onclick="document.getElementById('All-templates').classList.toggle('hide')">Do not click here. (debugging section)</button>
<div id=All-templates class=hide>

<h3>Known bugs, wishlist and changelog:</h3>
<ul ><li><s>Copying lane destinations along with lanes</s>
</li><li><s>First row of destinations can't be deleted, but shows button</s>
</li><li><s>This webpage is utterly useless as there's no export functionality</s>
</li><li><s>Formatting support for changelog</s>
</li><li><s>New lane destination field is created only on-click (not on-input).</s>
</li><li><s>Changelog too long, moved to hidden section.</s>
</li><li><s>Relocated hosting to github.  Added dynamic warning when visiting old site.</s>
</li><li><s>Adding new destination field preservers key.</s>
</li><li><s>Add lane changing tags. Todo for that: Update export function.</s>
</li><li><s>First lane is automatically added when page loads.</s>
</li><li><s>Bug caused duplicate tagging when lane was copied because of duplicate IDs, when new elements were generated too quickly.</s>
</li><li><s>Added colored indicators for lane changing.</s>
</li><li><s>Added none to empty destination lanes.</s>
</li><li><s>Change:lanes=|, when using 1-lane road.</s>
</li><li><s>Draggable destination fields</s>
</li><li><s>Add custom UI for LHT (steering wheel on right side) roads.</s>
</li><li><s>Import capability needed</s>
</li><li><s>Draggable lanes</s>
</li><li><s>Different lanes should be aligned.</s> Potential workaround by aligning to bottom.
</li><li>Forward-backward lanes.  <b>!!! Only oneway is supported for now. !!!</b>
</li><li>Pressing enter could move cursor to new field
</li><li>Css styling should use classes
</li><li>Auto-updating export box would be cool.
</li><li>Destination field shouldn't be draggable to last position. - Fix made things worse
</li><li>...and many more
</li></ul>
<h2>Templates for js to generate new lanes.</h2>
Please avoid touching tables below as they are used to generate new lanes.<br> This tool is open-source. To view source, right-click and select "View page source" :-P
<h3>Lanes</h3>
<div id=template1 >
<table id="{lane_id}" border=1 width=390px>
 <tr>
  <td colspan=3 id="dest_cell_{lane_id}">
  Reserved for <i>destination field selector {lane_id}</i>
  </td>
 </tr>
 <tr>
  <td colspan=3 id="arrow_cell_{lane_id}">
  Reserved for <i>Lane arrows selection tool</i>
  </td>
 </tr>
 <tr>
  <td width=140px><button onclick="copyRight('{lane_id}')" title="Duplicates lane with current setting">Copy lane</button></td>
  <td width=95px><button onclick="deleteByID(lane_{lane_id})" title="This deletes the current lane. If you have no more lanes, you can add more from button above">Delete lane</button></td>
  <td width=155px><button class="lanechange_btn hide" id="change_lane_{lane_id}" onclick="lane_test('{lane_id}')" 
  title="This lane change applies to changing BOTH to and from the lane on RIGHT side.
For changing between lane on the left, see column on the left.
Clicking this button cycles through 3 states: none (default), no and yes.
More advanced lane changing options, such as lane change from A to lane B, but not vice versa, are not supported, but can be added manually after exporting.">Allow lane change? üüß</button></td>
 </tr>
</table>
</div>

<h4>Destination field selector</h4>
<div id=template2 >
<table id="dest_table_{lane_id}" class="dest_table" border=1 width=390px >
 <tr id="dest_row_{dest_row_id}" class="dest_row">
  <td>
    selection list
  </td>
  <td >
    input field
  </td>
  <td>
    delete button
  </td>
 </tr>
 </tbody>
</table>
</div>

<h4>Lane arrows selection tool</h4>
<div id=template3 >
<table id="arrow_table_{lane_id}" border=1 width=390px>
 <tr style='page-break-inside:avoid'>
  <td width=140px>
  <input type="checkbox" id="arrow_{lane_id}_1" name="arrow_{lane_id}" value="merge_to_left" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_1"><tt>merge_to_left</tt></label>
  </td>
  <td width=110 valign=top style=' '>
  
  <input type="checkbox" id="arrow_{lane_id}_2"  name="arrow_{lane_id}" value="through" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_2"><tt>through</tt></label>
  </td>
  <td width=140px>
  <input type="checkbox" id="arrow_{lane_id}_3"  name="arrow_{lane_id}" value="merge_to_right" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_3"><tt>merge_to_right</tt></label>
  </td>
 </tr>
 <tr style='page-break-inside:avoid'>
  <td>
  <input type="checkbox" id="arrow_{lane_id}_4"  name="arrow_{lane_id}" value="slight_left" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_4"><tt>slight_left</tt></label>
  </td>
  <td rowspan=3 id="arrows_{lane_id}" style="vertical-align: top;" >
  <div>
<img id="arrow_{lane_id}_img_6" class=hide width=97 height=69 src="Left.png">
<img id="arrow_{lane_id}_img_1" class=hide width=97 height=69 src="Merge-left.png">
<img id="arrow_{lane_id}_img_3" class=hide width=97 height=69 src="Merge-right.png">
<img id="arrow_{lane_id}_img_7" class=hide width=97 height=69 src="Right.png">
<img id="arrow_{lane_id}_img_4" class=hide width=97 height=69 src="Slight-left.png">
<img id="arrow_{lane_id}_img_5" class=hide width=97 height=69 src="Slight-right.png">
<img id="arrow_{lane_id}_img_2" class=hide width=97 height=69 src="Through.png">
<img id="arrow_{lane_id}_img_8" class="hide uturn" width=97 height=69 src="U.png">
<!--img id="arrow_{lane_id}_img_9" width=97 height=69 src="U-lht.png"-->
  </div>
  </td>
  <td>
  <input type="checkbox" id="arrow_{lane_id}_5"  name="arrow_{lane_id}" value="slight_right" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_5"><tt>slight_right</tt></label>
  </td>
 </tr>
 <tr style='page-break-inside:avoid'>
  <td>
  <input type="checkbox" id="arrow_{lane_id}_6"  name="arrow_{lane_id}" value="left" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_6"><tt>Left</tt></label>
  </td>
  <td>
  <input type="checkbox" id="arrow_{lane_id}_7"  name="arrow_{lane_id}" value="right" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_7"><tt>Right</tt></label>
  </td>
 </tr>
 <tr style='page-break-inside:avoid' class="Reverse_none">
  <td>
  <input type="checkbox" id="arrow_{lane_id}_8"  name="arrow_{lane_id}" value="reverse" onclick='update_arrow("{lane_id}");' >
  <label for="arrow_{lane_id}_8"><tt>Reverse</tt></label>
  </td>
  <td>
  <input type="checkbox" id="arrow_{lane_id}_9"  name="arrow_{lane_id}" value="none" onclick='update_arrow_2("{lane_id}");' >
  <label for="arrow_{lane_id}_9"><tt>None</tt></label>
  </td>
 </tr>
</table>
</div>

<h4>Destinations:</h4>
<table id="test table" border=1 width=390px>
 <tr id=template4>
  <td width=140px>
    <select name="selection_{lane_id}_{dest_row_id}" id="selection_{lane_id}_{dest_row_id}" class="destiation_select">
      <option value="" disabled selected>Type of destination</option>
      <option value="destination">Destination</option>
      <option value="destination:ref">Ref</option>
      <option value="destination:int_ref">Int_ref</option>
      <option value="destination:street">Street</option>
      <option value="destination:symbol">Symbol</option>
    </select>
  </td>
  <td >
    <input  name="input_{lane_id}_{dest_row_id}" id="input_{lane_id}_{dest_row_id}" placeholder="Click to add new" onclick="new_destination('{lane_id}', document.getElementById( 'selection_{lane_id}_{dest_row_id}').value)" oninput="new_destination('{lane_id}', document.getElementById( 'selection_{lane_id}_{dest_row_id}').value)" class="destiation_input"></input><span class=hide>‚ñë‚ñë</span>
  </td>
  <td width=45px>
    <button onclick="deleteByID(dest_row_{dest_row_id})" class="hide" title="Delete row">‚ùå</button>
  </td>
 </tr>
</table>
</div>
</body>
</html>
